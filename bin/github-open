#!/usr/bin/env sh

# Opens the current github repository in the default browser

REMOTES=`git remote show`
if [ -z "$REMOTES" ]
then
  echo "No git remote found, please set 'origin' remote"
  exit 1;
fi

REPOLINK=`git remote get-url origin`
echo "     Found link: $REPOLINK"

HAS_SSH_PREFIX=$(echo $REPOLINK | grep "git@github.com:")
if [ "$HAS_SSH_PREFIX" ]
then 
  echo "                  ^ has ssh prefix (converting to https link)"
  # Converts from ssh format to https format if necessary
  REPOLINK=$(echo $REPOLINK | sed "s/git\@github\.com\:/https:\/\/github\.com\//");
else
  echo "                  ^ has http prefix"
fi

HAS_DOT_GIT_SUFFIX=$(echo $REPOLINK | grep "\.git$")
if [ "$HAS_DOT_GIT_SUFFIX" ]
then 
  echo "                  ^ has .git suffix (removing .git)"
  REPOLINK=$(echo $REPOLINK | sed 's/\(.*\)\.git$/\1/');
fi

echo "Opening webpage: $REPOLINK"

# OS specific
case "$OSTYPE" in
# Mac
darwin*)
  open $REPOLINK;
  ;;
# Linux
linux*)
  xdg-open $REPOLINK;
  ;;
esac
